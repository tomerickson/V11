"use strict";(self.webpackChunkv11=self.webpackChunkv11||[]).push([[316],{8356:(Pe,S,r)=>{r.r(S),r.d(S,{ALL_RESULTS_ROUTES:()=>ze});var R={};r.r(R),r.d(R,{fetchAllResultsErrorAlert:()=>X,getCurrentPageEffect:()=>B,getFirstPageEffect:()=>j,loadResultsEffect:()=>I,refreshAllResultsEffect:()=>K});var p=r(7483),i=r(4221),C=r(8675),L=r(2678),e=r(9212),v=r(2096),U=r(6328),D=r(2460);function x(t){return(0,U.b)(a=>{const s=t(a),n=Array.isArray(s)?s:[s];return(0,v.of)(a).pipe((0,D.M)(...n))})}var f=r(7398),z=r(4664),w=r(6306),O=r(9397),Q=r(2401);class N extends Q.C{constructor(a,s){super(a,s,1)}}var J=r(145),k=r(6414),Z=r(8045);const H=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];let h=(()=>{class t{constructor(){this.store=(0,e.f3M)(i.yh),this.config=(0,e.f3M)(J._Z),this.crud=(0,e.f3M)(k.I),this.page="list_results.php",this.getAllResultsPage=s=>this.crud.getPage(this.page),this.refreshResults=s=>{const n=new FormData;n.append("doit","refresh"),n.append("order",s);const o=(0,Z.Fj)(n);return this.crud.postPage(this.page,o)},this.extractResultsTable=s=>{const m=(new DOMParser).parseFromString(s,"text/html").body.querySelector("table.results").rows[0].cells[0].innerText,_=new N(s,[m]);return _.reactionResults.splice(0,1),_.reactionResults=_.reactionResults.map(A=>this.rowHandler(A)),_},this.rowHandler=s=>{const n={};return n.query=s[0],n.size=s[1],n.date=(t=>{let a=new Date(0);const s=RegExp("^(\\d{2}).(\\w{3}).(\\d{4}).(\\d{2}).(\\d{2}).(\\d{2})$"),n=t.match(s);if(n&&n.length>6){const o=+n[3],l=H.findIndex(Ze=>Ze===n[2].toLowerCase());a=new Date(o,l,+n[1],+n[4],+n[5],+n[6])}return a})(s[2]),n.link=(0,Z.GM)(s[3]),n},this.navigate=s=>{this.store.dispatch(c.setPage({payload:s}))},this.openLink=s=>{window.open(`${this.config.apiUrl}${s}`,"_blank","noreferrer, noopener")}}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var G=r(2744);const j=(0,p.GW)((t=(0,e.f3M)(p.eX))=>{const a=(0,e.f3M)(i.yh);return t.pipe((0,p.l4)(c.loadResultsSuccess),x(()=>a.select(d.selectNavigator)),(0,f.U)(([,s])=>c.setPage({payload:{page:1,size:10,sizes:s.sizes}})))},{functional:!0}),B=(0,p.GW)((t=(0,e.f3M)(p.eX))=>{const a=(0,e.f3M)(i.yh);return t.pipe((0,p.l4)(c.sort),x(()=>a.select(d.selectNavigator)),(0,f.U)(([,s])=>c.setPage({payload:s})))},{functional:!0}),I=(0,p.GW)((t=(0,e.f3M)(p.eX))=>{const a=(0,e.f3M)(h);return t.pipe((0,p.l4)(c.loadResults),(0,z.w)(s=>a.getAllResultsPage(s.query).pipe((0,f.U)(n=>a.extractResultsTable(n)),(0,f.U)(n=>c.loadResultsSuccess({payload:n})),(0,w.K)(n=>(0,v.of)(c.loadResultsFailure({error:n}))))))},{functional:!0}),K=(0,p.GW)((t=(0,e.f3M)(p.eX))=>{const a=(0,e.f3M)(h);return t.pipe((0,p.l4)(c.refreshResults),(0,z.w)(s=>a.refreshResults(s.sort).pipe((0,f.U)(n=>a.extractResultsTable(n)),(0,f.U)(n=>c.loadResultsSuccess({payload:n})),(0,w.K)(n=>(0,v.of)(c.loadResultsFailure({error:n}))))))},{functional:!0}),X=(0,p.GW)(()=>{const t=(0,e.f3M)(G.c);return(0,e.f3M)(p.eX).pipe((0,p.l4)(c.loadResultsFailure),(0,O.b)(()=>t.showClientError("No results found.")))},{functional:!0,dispatch:!1}),c=(0,i.R7)({source:"AllResults API",events:{Reset:(0,i.uZ)(),loadResults:(0,i.Ky)(),loadResultsSuccess:(0,i.Ky)(),loadResultsFailure:t=>({error:t}),refreshResults:(0,i.Ky)(),setPage:(0,i.Ky)(),sort:(0,i.Ky)()}});function $(t,a){return(s,n)=>{let o;return o="number"==typeof+s[t]?P(+s[t],+n[t]):P(s[t],n[t]),"desc"===a&&(o=0-o),o}}const P=(t,a)=>t<a?-1:t>a?1:0,F={query:"",loading:!1,ready:!1,error:null,results:[],page:[],navigator:{page:1,size:10,sizes:[5,10,15,20]},pageNumber:1,pageSize:10},W=(0,i.Lq)(F,(0,i.on)(c.reset,()=>({...F})),(0,i.on)(c.loadResults,(t,a)=>({...t,query:a.query,loading:!0,ready:!1,error:null,results:[]})),(0,i.on)(c.loadResultsSuccess,(t,a)=>({...t,ready:!0,loading:!1,results:a.payload.reactionResults})),(0,i.on)(c.loadResultsFailure,(t,a)=>({...t,loading:!1,error:a.error})),(0,i.on)(c.setPage,(t,a)=>{const n=(a.payload.page-1)*a.payload.size,o=Math.min(n+a.payload.size,t.results.length);return{...t,pageNumber:a.payload.page,pageSize:a.payload.size,page:t.results.slice(n,o)}}),(0,i.on)(c.sort,(t,a)=>{const s=a.payload.active;return{...t,results:[...t.results].sort($(s,a.payload.direction))}})),d=(0,i.Tz)({name:"all-results",reducer:W,extraSelectors:({selectResults:t})=>({selectRows:(0,i.P1)(t,a=>a.length)})});var u=r(6814),T=r(5195),y=r(3566),g=r(5313),M=r(2296),q=r(5683),b=r(617),V=r(8525);function ee(t,a){if(1&t&&(e.TgZ(0,"option",8),e._uU(1),e.qZA()),2&t){const s=a.$implicit,n=e.oxw();e.Q6J("selected",s==n.pageSize)("value",s),e.xp6(1),e.hij(" ",s," ")}}let E=(()=>{class t{constructor(){this.pageSize=10,this.pageSizes=[5,10,15,25],this.navigator={page:1,size:this.pageSize,sizes:this.pageSizes},this.pager=new e.vpe,this.setPageSize=s=>{this.pageSize=+s.srcElement.value,this.emitEvent(this.navigator.page)},this.firstRow=()=>(this.navigator.page-1)*this.navigator.size+1,this.lastRow=()=>Math.min(this.navigator.page*this.navigator.size,this.rows?this.rows:0),this.nextPage=()=>{this.emitEvent(this.navigator.page+1)},this.priorPage=()=>{this.emitEvent(this.navigator.page-1)},this.firstPage=()=>{this.emitEvent(1)},this.lastPage=()=>{this.emitEvent(this.endPage)},this.emitEvent=s=>{const n={page:s,size:this.pageSize,sizes:this.pageSizes};this.navigator=n,this.pager.emit(n)}}get endPage(){return Math.ceil(this.rows?this.rows/this.pageSize:1)}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-custom-paginator"]],inputs:{rows:"rows"},outputs:{pager:"pager"},standalone:!0,features:[e.jDz],decls:24,vars:6,consts:[[1,"wrapper"],[1,"boxed"],["matNativeControl","","name","pageSize","title","page size",3,"change"],[3,"selected","value",4,"ngFor","ngForOf"],["type","button","title","First Page","mat-icon-button","",3,"click"],["type","button","title","Previous Page","mat-icon-button","",3,"disabled","click"],["type","button","title","Next Page","mat-icon-button","",3,"disabled","click"],["type","button","title","Last Page","mat-icon-button","",3,"click"],[3,"selected","value"]],template:function(n,o){1&n&&(e.TgZ(0,"div",0)(1,"span"),e._uU(2,"Items per page:"),e.qZA(),e.TgZ(3,"div",1)(4,"span")(5,"div")(6,"select",2),e.NdJ("change",function(m){return o.setPageSize(m)}),e.YNc(7,ee,2,3,"option",3),e.qZA()()()(),e.TgZ(8,"div")(9,"span"),e._uU(10),e.qZA()(),e.TgZ(11,"div")(12,"button",4),e.NdJ("click",function(){return o.firstPage()}),e.TgZ(13,"mat-icon"),e._uU(14,"first_page"),e.qZA()(),e.TgZ(15,"button",5),e.NdJ("click",function(){return o.priorPage()}),e.TgZ(16,"mat-icon"),e._uU(17,"chevron_left"),e.qZA()(),e.TgZ(18,"button",6),e.NdJ("click",function(){return o.nextPage()}),e.TgZ(19,"mat-icon"),e._uU(20,"chevron_right"),e.qZA()(),e.TgZ(21,"button",7),e.NdJ("click",function(){return o.lastPage()}),e.TgZ(22,"mat-icon"),e._uU(23,"last_page"),e.qZA()()()()),2&n&&(e.xp6(7),e.Q6J("ngForOf",o.pageSizes),e.xp6(3),e.lnq("",o.firstRow()," - ",o.lastRow()," of ",o.rows,""),e.xp6(5),e.Q6J("disabled",o.navigator.page<2),e.xp6(3),e.Q6J("disabled",o.navigator.page==o.endPage))},dependencies:[u.ez,u.sg,M.ot,M.RK,q.lN,b.Ps,b.Hw,V.LD],styles:["div.wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:flex-start}div.wrapper[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{margin-left:1ex}.boxed[_ngcontent-%COMP%]{display:flex;flex-direction:row;border:1px solid lightgray;border-radius:5px;padding:1em;color:#000c}select[_ngcontent-%COMP%]{border:none;background-color:transparent;width:5em}"]})}return t})();var te=r(2070);function se(t,a){1&t&&e.GkF(0)}function ne(t,a){if(1&t&&(e.ynx(0),e.YNc(1,se,1,0,"ng-container",7),e.BQk()),2&t){e.oxw();const s=e.MAs(7);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}function ae(t,a){1&t&&e.GkF(0)}function oe(t,a){if(1&t&&(e.ynx(0),e.YNc(1,ae,1,0,"ng-container",7),e.BQk()),2&t){e.oxw();const s=e.MAs(9);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}function re(t,a){1&t&&e.GkF(0)}function le(t,a){if(1&t&&(e.ynx(0),e.YNc(1,re,1,0,"ng-container",7),e.BQk()),2&t){e.oxw();const s=e.MAs(11);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}function ie(t,a){if(1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div"),e._uU(3,"An error occurred!"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"json"),e.qZA()()()),2&t){const s=e.oxw();e.xp6(5),e.Oqu(e.lcZ(6,1,s.error))}}function ce(t,a){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content"),e._UZ(2,"mfmp-progress-spinner"),e.qZA()())}function pe(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Query"),e.qZA())}function ue(t,a){if(1&t&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&t){const s=a.$implicit;e.xp6(1),e.Oqu(s.query)}}function ge(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Size"),e.qZA())}function me(t,a){if(1&t&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&t){const s=a.$implicit;e.xp6(1),e.Oqu(s.size)}}function de(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Date"),e.qZA())}function fe(t,a){if(1&t&&(e.TgZ(0,"td",21),e._uU(1),e.ALo(2,"date"),e.qZA()),2&t){const s=a.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,s.date,"dd-MMM-yyyy HH:mm:ss")," ")}}function he(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Link"),e.qZA())}function _e(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){const l=e.CHM(s).$implicit,m=e.oxw(3);return e.KtG(m.openLink(l.link))}),e._uU(1," Open "),e.qZA()}}function ve(t,a){1&t&&e._UZ(0,"tr",23)}function ye(t,a){1&t&&e._UZ(0,"tr",24)}function Re(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"table",10),e.NdJ("matSortChange",function(o){e.CHM(s);const l=e.oxw(2);return e.KtG(l.sortTable(o))}),e.ynx(1,11),e.YNc(2,pe,2,0,"th",12)(3,ue,2,1,"td",13),e.BQk(),e.ynx(4,14),e.YNc(5,ge,2,0,"th",12)(6,me,2,1,"td",13),e.BQk(),e.ynx(7,15),e.YNc(8,de,2,0,"th",12)(9,fe,3,4,"td",13),e.BQk(),e.ynx(10,16),e.YNc(11,he,2,0,"th",12)(12,_e,2,0,"td",17),e.BQk(),e.YNc(13,ve,1,0,"tr",18)(14,ye,1,0,"tr",19),e.qZA()}if(2&t){const s=e.oxw(2);e.Q6J("dataSource",s.resultList)("trackBy",s.tracker),e.xp6(13),e.Q6J("matHeaderRowDef",s.displayColumns),e.xp6(1),e.Q6J("matRowDefColumns",s.displayColumns)}}function Ce(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"mat-card")(1,"mat-card-content"),e.YNc(2,Re,15,4,"table",8),e.TgZ(3,"div")(4,"mfmp-custom-paginator",9),e.NdJ("pager",function(o){e.CHM(s);const l=e.oxw();return e.KtG(l.handlePageEvent(o))}),e.qZA()()()()}if(2&t){const s=e.oxw();e.xp6(2),e.Q6J("ngIf",s.resultList),e.xp6(2),e.Q6J("rows",s.rows?s.rows:void 0)}}let Te=(()=>{class t{constructor(){this.featureService=(0,e.f3M)(h),this.sorter=new e.vpe,this.opener=new e.vpe,this.displayColumns=["query","size","date","link"],this.sortedData=[],this.buildDataSource=()=>{this.dataSource=new g.by(this.resultList||[])},this.openLink=s=>{this.opener.emit(s)}}set ready(s){this.flowSwitch=s?2:0+(this.error?1:0)}set error(s){this.flowSwitch=this.ready?2:0+(s?1:0)}sortTable(s){this.sorter.emit(s)}ngOnInit(){this.buildDataSource()}ngAfterViewInit(){this.resultList&&(this.dataSource.data=this.resultList,this.dataSource.sort=this.sort)}tracker(s,n){return n.link}handlePageEvent(s){console.log("from custompaginator.nextPage");const n=s;n.page=s.page,n.size=s.size,n.sizes=s.sizes,this.pageSize=n.size,this.pageIndex=n.page,this.pageSizes=n.sizes,this.featureService.navigate(n)}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-all-results-face"]],viewQuery:function(n,o){if(1&n&&e.Gf(y.YE,5),2&n){let l;e.iGM(l=e.CRH())&&(o.sort=l.first)}},inputs:{pageSize:"pageSize",pageSizes:"pageSizes",rows:"rows",ready:"ready",error:"error",resultList:"resultList"},outputs:{sorter:"sorter",opener:"opener"},standalone:!0,features:[e.jDz],decls:12,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"wrapper"],["errorTemplate",""],["waitingTemplate",""],["readyTemplate",""],[4,"ngTemplateOutlet"],["mat-table","","matSort","","displayedColumns","displayColumns",3,"dataSource","trackBy","matSortChange",4,"ngIf"],[3,"rows","pager"],["mat-table","","matSort","","displayedColumns","displayColumns",3,"dataSource","trackBy","matSortChange"],["matColumnDef","query"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","size"],["matColumnDef","date"],["matColumnDef","link"],["class","hover","mat-cell","",3,"click",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"hover",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,o){1&n&&(e.ynx(0,0),e.YNc(1,ne,2,1,"ng-container",1)(2,oe,2,1,"ng-container",1)(3,le,2,1,"ng-container",2),e.BQk(),e.TgZ(4,"mat-card",3)(5,"mat-card-content"),e.YNc(6,ie,7,3,"ng-template",null,4,e.W1O)(8,ce,3,0,"ng-template",null,5,e.W1O)(10,Ce,5,2,"ng-template",null,6,e.W1O),e.qZA()()),2&n&&(e.Q6J("ngSwitch",o.flowSwitch),e.xp6(1),e.Q6J("ngSwitchCase",1),e.xp6(1),e.Q6J("ngSwitchCase",0))},dependencies:[u.ez,u.O5,u.tP,u.RF,u.n9,u.ED,u.Ts,u.uU,T.QW,T.a8,T.dn,y.JX,y.YE,y.nU,g.p0,g.BZ,g.fO,g.as,g.w1,g.Dz,g.nj,g.ge,g.ev,g.XQ,g.Gk,E,te.O],styles:[".wrapper[_ngcontent-%COMP%]{height:100%}.hover[_ngcontent-%COMP%]:hover{cursor:pointer;text-decoration:underline}"]})}return t})();var Ae=r(5619),Se=r(1476);class xe{}const ze=[{path:"",component:(()=>{class t{constructor(){this.store=(0,e.f3M)(i.yh),this.headerService=(0,e.f3M)(C.d),this.featureService=(0,e.f3M)(h),this.results=(0,v.of)([]),this.pageIndex=0,this.pageSize=new Ae.X(10),this.pageSizes=[5,10,15,25],this.pageEvent=new Se.kl,this.pageManager=new xe,this.openLink=s=>{this.featureService.openLink(s)},this.sortData=s=>{this.store.dispatch(c.sort({payload:s}))}}ngOnInit(){this.page=(0,v.of)([]),this.pageManager.page=1,this.pageManager.size=10,this.pageManager.sizes=this.pageSizes,this.headerService.buildPageHeader("all-results"),this.results=this.store.select(d.selectResults),this.page=this.store.select(d.selectPage),this.rows=this.store.select(d.selectRows),this.ready=this.store.select(d.selectReady),this.error=this.store.select(d.selectError),this.store.dispatch(c.loadResults({query:"TODO: remove this"}))}switchPage(s){const n=s;console.log(`head: navigator: ${n}`),this.pageSize.next(n.size),this.store.dispatch(c.setPage({payload:n}))}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-all-results-head"]],standalone:!0,features:[e.jDz],decls:6,vars:16,consts:[[3,"resultList","pageSize","pageSizes","ready","error","rows","opener","sorter"]],template:function(n,o){1&n&&(e.TgZ(0,"mfmp-all-results-face",0),e.NdJ("opener",function(m){return o.openLink(m)})("sorter",function(m){return o.sortData(m)}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()),2&n&&e.Q6J("resultList",e.lcZ(1,6,o.page))("pageSize",e.lcZ(2,8,o.pageSize))("pageSizes",o.pageSizes)("ready",e.lcZ(3,10,o.ready))("error",e.lcZ(4,12,o.error))("rows",e.lcZ(5,14,o.rows))},dependencies:[u.ez,u.Ov,Te],encapsulation:2})}return t})(),providers:[{provide:h,useClass:h},{provide:C.d,useClass:C.d},(0,i.oY)(d),(0,p.y3)([R])],children:[{path:"reports",component:L.a},{path:"paginator",component:E}]}]}}]);