"use strict";(self.webpackChunkv11=self.webpackChunkv11||[]).push([[745],{3745:(Ae,T,o)=>{o.r(T),o.d(T,{ALL_RESULTS_ROUTES:()=>ye});var y={};o.r(y),o.d(y,{fetchAllResultsErrorAlert:()=>B,getCurrentPageEffect:()=>b,getFirstPageEffect:()=>J,loadResultsEffect:()=>G,refreshAllResultsEffect:()=>k});var i=o(7483),r=o(4221),R=o(8675),N=o(2678),e=o(5879),h=o(7398),z=o(4664),F=o(6306),v=o(2096),E=o(9397),D=o(2401);class P extends D.C{constructor(n,a){super(n,a,1)}}var Q=o(4665),U=o(6414),w=o(8045);const Y=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];let g=(()=>{var t;class n{constructor(){this.store=(0,e.f3M)(r.yh),this.config=(0,e.f3M)(Q._),this.crud=(0,e.f3M)(U.I),this.page="list_results.php",this.getAllResultsPage=s=>this.crud.getPage(this.page),this.refreshResults=s=>{const l=new FormData;l.append("doit","refresh"),l.append("order",s);const u=(0,w.Fj)(l);return this.crud.postPage(this.page,u)},this.extractResultsTable=s=>{const S=(new DOMParser).parseFromString(s,"text/html").body.querySelector("table.results").rows[0].cells[0].innerText,_=new P(s,[S]);return _.reactionResults.splice(0,1),_.reactionResults=_.reactionResults.map(x=>this.rowHandler(x)),_},this.rowHandler=s=>{const l={};return l.query=s[0],l.size=s[1],l.date=(t=>{let n=new Date(0);const a=RegExp("^(\\d{2}).(\\w{3}).(\\d{4}).(\\d{2}).(\\d{2}).(\\d{2})$"),s=t.match(a);if(s&&s.length>6){const l=+s[3],u=Y.findIndex(ve=>ve===s[2].toLowerCase());n=new Date(l,u,+s[1],+s[4],+s[5],+s[6])}return n})(s[2]),l.link=(0,w.GM)(s[3]),l},this.navigate=s=>{this.store.dispatch(c.setPage({payload:s}))},this.openLink=s=>{window.open(s,"_blank","noreferrerr, noopener")}}}return(t=n).\u0275fac=function(s){return new(s||t)},t.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac}),n})();var H=o(2744);const J=(0,i.GW)((t=(0,e.f3M)(i.eX))=>{const n=(0,e.f3M)(r.yh);return t.pipe((0,i.l4)(c.loadResultsSuccess),(0,i.IC)(()=>n.select(m.selectNavigator)),(0,h.U)(([,a])=>c.setPage({payload:{page:1,size:10,sizes:a.sizes}})))},{functional:!0}),b=(0,i.GW)((t=(0,e.f3M)(i.eX))=>{const n=(0,e.f3M)(r.yh);return t.pipe((0,i.l4)(c.sort),(0,i.IC)(()=>n.select(m.selectNavigator)),(0,h.U)(([,a])=>c.setPage({payload:a})))},{functional:!0}),G=(0,i.GW)((t=(0,e.f3M)(i.eX))=>{const n=(0,e.f3M)(g);return t.pipe((0,i.l4)(c.loadResults),(0,z.w)(a=>n.getAllResultsPage(a.query).pipe((0,h.U)(s=>n.extractResultsTable(s)),(0,h.U)(s=>c.loadResultsSuccess({payload:s})),(0,F.K)(s=>(0,v.of)(c.loadResultsFailure({error:s}))))))},{functional:!0}),k=(0,i.GW)((t=(0,e.f3M)(i.eX))=>{const n=(0,e.f3M)(g);return t.pipe((0,i.l4)(c.refreshResults),(0,z.w)(a=>n.refreshResults(a.sort).pipe((0,h.U)(s=>n.extractResultsTable(s)),(0,h.U)(s=>c.loadResultsSuccess({payload:s})),(0,F.K)(s=>(0,v.of)(c.loadResultsFailure({error:s}))))))},{functional:!0}),B=(0,i.GW)(()=>{const t=(0,e.f3M)(H.c);return(0,e.f3M)(i.eX).pipe((0,i.l4)(c.loadResultsFailure),(0,E.b)(()=>t.showClientError("No results found.")))},{functional:!0,dispatch:!1}),c=(0,r.R7)({source:"AllResults API",events:{Reset:(0,r.uZ)(),loadResults:(0,r.Ky)(),loadResultsSuccess:(0,r.Ky)(),loadResultsFailure:t=>({error:t}),refreshResults:(0,r.Ky)(),setPage:(0,r.Ky)(),sort:(0,r.Ky)()}});function I(t,n){return(a,s)=>{let l;return l="number"==typeof+a[t]?Z(+a[t],+s[t]):Z(a[t],s[t]),"desc"===n&&(l=0-l),l}}const Z=(t,n)=>t<n?-1:t>n?1:0,M={query:"",loading:!1,ready:!1,error:null,results:[],page:[],navigator:{page:1,size:10,sizes:[5,10,15,20]},pageNumber:1,pageSize:10},j=(0,r.Lq)(M,(0,r.on)(c.reset,()=>({...M})),(0,r.on)(c.loadResults,(t,n)=>({...t,query:n.query,loading:!0,ready:!1,error:null,results:[]})),(0,r.on)(c.loadResultsSuccess,(t,n)=>({...t,ready:!0,loading:!1,results:n.payload.reactionResults})),(0,r.on)(c.loadResultsFailure,(t,n)=>({...t,loading:!1,error:n.error})),(0,r.on)(c.setPage,(t,n)=>{const s=(n.payload.page-1)*n.payload.size,l=Math.min(s+n.payload.size,t.results.length);return{...t,pageNumber:n.payload.page,pageSize:n.payload.size,page:t.results.slice(s,l)}}),(0,r.on)(c.sort,(t,n)=>{const a=n.payload.active;return{...t,results:[...t.results].sort(I(a,n.payload.direction))}})),m=(0,r.Tz)({name:"all-results",reducer:j,extraSelectors:({selectResults:t})=>({selectRows:(0,r.P1)(t,n=>n.length)})});var d=o(6814),A=o(3566),p=o(5313),L=o(8888),K=o(2070),C=o(5195);function X(t,n){1&t&&e.GkF(0)}function W(t,n){if(1&t&&(e.ynx(0),e.YNc(1,X,1,0,"ng-container",6),e.BQk()),2&t){e.oxw();const a=e.MAs(7);e.xp6(1),e.Q6J("ngTemplateOutlet",a)}}function $(t,n){1&t&&e.GkF(0)}function q(t,n){if(1&t&&(e.ynx(0),e.YNc(1,$,1,0,"ng-container",6),e.BQk()),2&t){e.oxw();const a=e.MAs(9);e.xp6(1),e.Q6J("ngTemplateOutlet",a)}}function V(t,n){1&t&&e.GkF(0)}function ee(t,n){if(1&t&&(e.ynx(0),e.YNc(1,V,1,0,"ng-container",6),e.BQk()),2&t){e.oxw();const a=e.MAs(11);e.xp6(1),e.Q6J("ngTemplateOutlet",a)}}function te(t,n){if(1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div"),e._uU(3,"An error occurred!"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"json"),e.qZA()()()),2&t){const a=e.oxw();e.xp6(5),e.Oqu(e.lcZ(6,1,a.error))}}function se(t,n){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content"),e._UZ(2,"mfmp-progress-spinner"),e.qZA()())}function ne(t,n){1&t&&(e.TgZ(0,"th",19),e._uU(1,"Query"),e.qZA())}function ae(t,n){if(1&t&&(e.TgZ(0,"td",20),e._uU(1),e.qZA()),2&t){const a=n.$implicit;e.xp6(1),e.Oqu(a.query)}}function le(t,n){1&t&&(e.TgZ(0,"th",19),e._uU(1,"Size"),e.qZA())}function oe(t,n){if(1&t&&(e.TgZ(0,"td",20),e._uU(1),e.qZA()),2&t){const a=n.$implicit;e.xp6(1),e.Oqu(a.size)}}function re(t,n){1&t&&(e.TgZ(0,"th",19),e._uU(1,"Date"),e.qZA())}function ce(t,n){if(1&t&&(e.TgZ(0,"td",20),e._uU(1),e.ALo(2,"date"),e.qZA()),2&t){const a=n.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,a.date,"dd-MMM-yyyy HH:mm:ss")," ")}}function ie(t,n){1&t&&(e.TgZ(0,"th",19),e._uU(1,"Link"),e.qZA())}function ue(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"td",21),e.NdJ("click",function(){const u=e.CHM(a).$implicit,f=e.oxw(3);return e.KtG(f.openLink(u.link))}),e._uU(1," Open "),e.qZA()}}function pe(t,n){1&t&&e._UZ(0,"tr",22)}function me(t,n){1&t&&e._UZ(0,"tr",23)}function de(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"table",9),e.NdJ("matSortChange",function(l){e.CHM(a);const u=e.oxw(2);return e.KtG(u.sortTable(l))}),e.ynx(1,10),e.YNc(2,ne,2,0,"th",11),e.YNc(3,ae,2,1,"td",12),e.BQk(),e.ynx(4,13),e.YNc(5,le,2,0,"th",11),e.YNc(6,oe,2,1,"td",12),e.BQk(),e.ynx(7,14),e.YNc(8,re,2,0,"th",11),e.YNc(9,ce,3,4,"td",12),e.BQk(),e.ynx(10,15),e.YNc(11,ie,2,0,"th",11),e.YNc(12,ue,2,0,"td",16),e.BQk(),e.YNc(13,pe,1,0,"tr",17),e.YNc(14,me,1,0,"tr",18),e.qZA()}if(2&t){const a=e.oxw(2);e.Q6J("dataSource",a.resultList)("trackBy",a.tracker),e.xp6(13),e.Q6J("matHeaderRowDef",a.displayColumns),e.xp6(1),e.Q6J("matRowDefColumns",a.displayColumns)}}function ge(t,n){if(1&t){const a=e.EpF();e.TgZ(0,"mat-card")(1,"mat-card-content"),e.YNc(2,de,15,4,"table",7),e.TgZ(3,"div")(4,"mfmp-custom-paginator",8),e.NdJ("pager",function(l){e.CHM(a);const u=e.oxw();return e.KtG(u.handlePageEvent(l))}),e.qZA()()()()}if(2&t){const a=e.oxw();e.xp6(2),e.Q6J("ngIf",a.resultList),e.xp6(2),e.Q6J("rows",a.rows?a.rows:void 0)}}let fe=(()=>{var t;class n{constructor(){this.featureService=(0,e.f3M)(g),this.sorter=new e.vpe,this.opener=new e.vpe,this.displayColumns=["query","size","date","link"],this.sortedData=[],this.buildDataSource=()=>{this.dataSource=new p.by(this.resultList||[])},this.openLink=s=>{this.opener.emit(s)}}set ready(s){this.flowSwitch=s?2:0+(this.error?1:0)}set error(s){this.flowSwitch=this.ready?2:0+(s?1:0)}sortTable(s){this.sorter.emit(s)}ngOnInit(){this.buildDataSource()}ngAfterViewInit(){this.resultList&&(this.dataSource.data=this.resultList,this.dataSource.sort=this.sort)}tracker(s,l){return l.link}handlePageEvent(s){console.log("from custompaginator.nextPage");const l=s;l.page=s.page,l.size=s.size,l.sizes=s.sizes,this.pageSize=l.size,this.pageIndex=l.page,this.pageSizes=l.sizes,this.featureService.navigate(l)}}return(t=n).\u0275fac=function(s){return new(s||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-all-results-face"]],viewQuery:function(s,l){if(1&s&&e.Gf(A.YE,5),2&s){let u;e.iGM(u=e.CRH())&&(l.sort=u.first)}},inputs:{pageSize:"pageSize",pageSizes:"pageSizes",rows:"rows",ready:"ready",error:"error",resultList:"resultList"},outputs:{sorter:"sorter",opener:"opener"},standalone:!0,features:[e.jDz],decls:12,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],["errorTemplate",""],["waitingTemplate",""],["readyTemplate",""],[4,"ngTemplateOutlet"],["mat-table","","matSort","","displayedColumns","displayColumns",3,"dataSource","trackBy","matSortChange",4,"ngIf"],[3,"rows","pager"],["mat-table","","matSort","","displayedColumns","displayColumns",3,"dataSource","trackBy","matSortChange"],["matColumnDef","query"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","size"],["matColumnDef","date"],["matColumnDef","link"],["class","hover","mat-cell","",3,"click",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"hover",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(s,l){1&s&&(e.ynx(0,0),e.YNc(1,W,2,1,"ng-container",1),e.YNc(2,q,2,1,"ng-container",1),e.YNc(3,ee,2,1,"ng-container",2),e.BQk(),e.TgZ(4,"mat-card")(5,"mat-card-content"),e.YNc(6,te,7,3,"ng-template",null,3,e.W1O),e.YNc(8,se,3,0,"ng-template",null,4,e.W1O),e.YNc(10,ge,5,2,"ng-template",null,5,e.W1O),e.qZA()()),2&s&&(e.Q6J("ngSwitch",l.flowSwitch),e.xp6(1),e.Q6J("ngSwitchCase",1),e.xp6(1),e.Q6J("ngSwitchCase",0))},dependencies:[d.ez,d.O5,d.tP,d.RF,d.n9,d.ED,d.Ts,d.uU,C.QW,C.a8,C.dn,A.JX,A.YE,A.nU,p.p0,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,L.y,K.O],styles:[".hover[_ngcontent-%COMP%]:hover{cursor:pointer;text-decoration:underline}"]}),n})();var he=o(5619),_e=o(1476);class Re{}const ye=[{path:"",component:(()=>{var t;class n{constructor(){this.store=(0,e.f3M)(r.yh),this.headerService=(0,e.f3M)(R.d),this.featureService=(0,e.f3M)(g),this.results=(0,v.of)([]),this.pageIndex=0,this.pageSize=new he.X(10),this.pageSizes=[5,10,15,25],this.pageEvent=new _e.kl,this.pageManager=new Re,this.openLink=s=>{this.featureService.openLink(s)},this.sortData=s=>{this.store.dispatch(c.sort({payload:s}))}}ngOnInit(){this.page=(0,v.of)([]),this.pageManager.page=1,this.pageManager.size=10,this.pageManager.sizes=this.pageSizes,this.headerService.buildPageHeader("all-results"),this.results=this.store.select(m.selectResults),this.page=this.store.select(m.selectPage),this.rows=this.store.select(m.selectRows),this.ready=this.store.select(m.selectReady),this.error=this.store.select(m.selectError),this.store.dispatch(c.loadResults({query:"TODO: remove this"}))}switchPage(s){const l=s;console.log(`head: navigator: ${l}`),this.pageSize.next(l.size),this.store.dispatch(c.setPage({payload:l}))}}return(t=n).\u0275fac=function(s){return new(s||t)},t.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-all-results-head"]],standalone:!0,features:[e.jDz],decls:6,vars:16,consts:[[3,"resultList","pageSize","pageSizes","ready","error","rows","opener","sorter"]],template:function(s,l){1&s&&(e.TgZ(0,"mfmp-all-results-face",0),e.NdJ("opener",function(f){return l.openLink(f)})("sorter",function(f){return l.sortData(f)}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()),2&s&&e.Q6J("resultList",e.lcZ(1,6,l.page))("pageSize",e.lcZ(2,8,l.pageSize))("pageSizes",l.pageSizes)("ready",e.lcZ(3,10,l.ready))("error",e.lcZ(4,12,l.error))("rows",e.lcZ(5,14,l.rows))},dependencies:[d.ez,d.Ov,fe],encapsulation:2}),n})(),providers:[(0,r.oY)(m),(0,i.y3)([y]),{provide:g,useClass:g},{provide:R.d,useClass:R.d}]},{path:"reports",component:N.a,providers:[(0,r.oY)(m),(0,i.y3)([y]),{provide:g,useClass:g},{provide:R.d,useClass:R.d}]},{path:"paginator",component:L.y}]}}]);