"use strict";(self.webpackChunkv11=self.webpackChunkv11||[]).push([[749],{6749:(Se,S,r)=>{r.r(S),r.d(S,{ALL_RESULTS_ROUTES:()=>Ae});var v={};r.r(v),r.d(v,{fetchAllResultsErrorAlert:()=>I,getCurrentPageEffect:()=>B,getFirstPageEffect:()=>G,loadResultsEffect:()=>k,refreshAllResultsEffect:()=>j});var u=r(7483),l=r(4221),y=r(8675),E=r(2678),e=r(9212),R=r(2096),P=r(6328),D=r(2460);function T(t){return(0,P.b)(a=>{const s=t(a),n=Array.isArray(s)?s:[s];return(0,R.of)(a).pipe((0,D.M)(...n))})}var h=r(7398),z=r(4664),w=r(6306),Q=r(9397),U=r(2401);class O extends U.C{constructor(a,s){super(a,s,1)}}var N=r(145),b=r(6414),F=r(8045);const H=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"];let f=(()=>{class t{constructor(){this.store=(0,e.f3M)(l.yh),this.config=(0,e.f3M)(N._Z),this.crud=(0,e.f3M)(b.I),this.page="list_results.php",this.getAllResultsPage=s=>this.crud.getPage(this.page),this.refreshResults=s=>{const n=new FormData;n.append("doit","refresh"),n.append("order",s);const o=(0,F.Fj)(n);return this.crud.postPage(this.page,o)},this.extractResultsTable=s=>{const g=(new DOMParser).parseFromString(s,"text/html").body.querySelector("table.results").rows[0].cells[0].innerText,_=new O(s,[g]);return _.reactionResults.splice(0,1),_.reactionResults=_.reactionResults.map(x=>this.rowHandler(x)),_},this.rowHandler=s=>{const n={};return n.query=s[0],n.size=s[1],n.date=(t=>{let a=new Date(0);const s=RegExp("^(\\d{2}).(\\w{3}).(\\d{4}).(\\d{2}).(\\d{2}).(\\d{2})$"),n=t.match(s);if(n&&n.length>6){const o=+n[3],c=H.findIndex(xe=>xe===n[2].toLowerCase());a=new Date(o,c,+n[1],+n[4],+n[5],+n[6])}return a})(s[2]),n.link=(0,F.GM)(s[3]),n},this.navigate=s=>{this.store.dispatch(i.setPage({payload:s}))},this.openLink=s=>{window.open(`${this.config.apiUrl}${s}`,"_blank","noreferrer, noopener")}}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275prov=e.Yz7({token:t,factory:t.\u0275fac})}return t})();var Y=r(2744);const G=(0,u.GW)((t=(0,e.f3M)(u.eX))=>{const a=(0,e.f3M)(l.yh);return t.pipe((0,u.l4)(i.loadResultsSuccess),T(()=>a.select(m.selectNavigator)),(0,h.U)(([,s])=>i.setPage({payload:{page:1,size:10,sizes:s.sizes}})))},{functional:!0}),B=(0,u.GW)((t=(0,e.f3M)(u.eX))=>{const a=(0,e.f3M)(l.yh);return t.pipe((0,u.l4)(i.sort),T(()=>a.select(m.selectNavigator)),(0,h.U)(([,s])=>i.setPage({payload:s})))},{functional:!0}),k=(0,u.GW)((t=(0,e.f3M)(u.eX))=>{const a=(0,e.f3M)(f);return t.pipe((0,u.l4)(i.loadResults),(0,z.w)(s=>a.getAllResultsPage(s.query).pipe((0,h.U)(n=>a.extractResultsTable(n)),(0,h.U)(n=>i.loadResultsSuccess({payload:n})),(0,w.K)(n=>(0,R.of)(i.loadResultsFailure({error:n}))))))},{functional:!0}),j=(0,u.GW)((t=(0,e.f3M)(u.eX))=>{const a=(0,e.f3M)(f);return t.pipe((0,u.l4)(i.refreshResults),(0,z.w)(s=>a.refreshResults(s.sort).pipe((0,h.U)(n=>a.extractResultsTable(n)),(0,h.U)(n=>i.loadResultsSuccess({payload:n})),(0,w.K)(n=>(0,R.of)(i.loadResultsFailure({error:n}))))))},{functional:!0}),I=(0,u.GW)(()=>{const t=(0,e.f3M)(Y.c);return(0,e.f3M)(u.eX).pipe((0,u.l4)(i.loadResultsFailure),(0,Q.b)(()=>t.showClientError("No results found.")))},{functional:!0,dispatch:!1}),i=(0,l.R7)({source:"AllResults API",events:{Reset:(0,l.uZ)(),loadResults:(0,l.Ky)(),loadResultsSuccess:(0,l.Ky)(),loadResultsFailure:t=>({error:t}),refreshResults:(0,l.Ky)(),setPage:(0,l.Ky)(),sort:(0,l.Ky)()}});function K(t,a){return(s,n)=>{let o;return o="number"==typeof+s[t]?Z(+s[t],+n[t]):Z(s[t],n[t]),"desc"===a&&(o=0-o),o}}const Z=(t,a)=>t<a?-1:t>a?1:0,M={query:"",loading:!1,ready:!1,error:null,results:[],page:[],navigator:{page:1,size:10,sizes:[5,10,15,20]},pageNumber:1,pageSize:10},X=(0,l.Lq)(M,(0,l.on)(i.reset,()=>({...M})),(0,l.on)(i.loadResults,(t,a)=>({...t,query:a.query,loading:!0,ready:!1,error:null,results:[]})),(0,l.on)(i.loadResultsSuccess,(t,a)=>({...t,ready:!0,loading:!1,results:a.payload.reactionResults})),(0,l.on)(i.loadResultsFailure,(t,a)=>({...t,loading:!1,error:a.error})),(0,l.on)(i.setPage,(t,a)=>{const n=(a.payload.page-1)*a.payload.size,o=Math.min(n+a.payload.size,t.results.length);return{...t,pageNumber:a.payload.page,pageSize:a.payload.size,page:t.results.slice(n,o)}}),(0,l.on)(i.sort,(t,a)=>{const s=a.payload.active;return{...t,results:[...t.results].sort(K(s,a.payload.direction))}})),m=(0,l.Tz)({name:"all-results",reducer:X,extraSelectors:({selectResults:t})=>({selectRows:(0,l.P1)(t,a=>a.length)})});var d=r(6814),A=r(3566),p=r(5313),L=r(8888),$=r(2070),C=r(5195);function W(t,a){1&t&&e.GkF(0)}function q(t,a){if(1&t&&(e.ynx(0),e.YNc(1,W,1,0,"ng-container",7),e.BQk()),2&t){e.oxw();const s=e.MAs(7);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}function V(t,a){1&t&&e.GkF(0)}function ee(t,a){if(1&t&&(e.ynx(0),e.YNc(1,V,1,0,"ng-container",7),e.BQk()),2&t){e.oxw();const s=e.MAs(9);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}function te(t,a){1&t&&e.GkF(0)}function se(t,a){if(1&t&&(e.ynx(0),e.YNc(1,te,1,0,"ng-container",7),e.BQk()),2&t){e.oxw();const s=e.MAs(11);e.xp6(1),e.Q6J("ngTemplateOutlet",s)}}function ne(t,a){if(1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content")(2,"div"),e._uU(3,"An error occurred!"),e.qZA(),e.TgZ(4,"div"),e._uU(5),e.ALo(6,"json"),e.qZA()()()),2&t){const s=e.oxw();e.xp6(5),e.Oqu(e.lcZ(6,1,s.error))}}function ae(t,a){1&t&&(e.TgZ(0,"mat-card")(1,"mat-card-content"),e._UZ(2,"mfmp-progress-spinner"),e.qZA()())}function oe(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Query"),e.qZA())}function re(t,a){if(1&t&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&t){const s=a.$implicit;e.xp6(1),e.Oqu(s.query)}}function le(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Size"),e.qZA())}function ie(t,a){if(1&t&&(e.TgZ(0,"td",21),e._uU(1),e.qZA()),2&t){const s=a.$implicit;e.xp6(1),e.Oqu(s.size)}}function ce(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Date"),e.qZA())}function ue(t,a){if(1&t&&(e.TgZ(0,"td",21),e._uU(1),e.ALo(2,"date"),e.qZA()),2&t){const s=a.$implicit;e.xp6(1),e.hij(" ",e.xi3(2,1,s.date,"dd-MMM-yyyy HH:mm:ss")," ")}}function pe(t,a){1&t&&(e.TgZ(0,"th",20),e._uU(1,"Link"),e.qZA())}function me(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"td",22),e.NdJ("click",function(){const c=e.CHM(s).$implicit,g=e.oxw(3);return e.KtG(g.openLink(c.link))}),e._uU(1," Open "),e.qZA()}}function de(t,a){1&t&&e._UZ(0,"tr",23)}function ge(t,a){1&t&&e._UZ(0,"tr",24)}function fe(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"table",10),e.NdJ("matSortChange",function(o){e.CHM(s);const c=e.oxw(2);return e.KtG(c.sortTable(o))}),e.ynx(1,11),e.YNc(2,oe,2,0,"th",12)(3,re,2,1,"td",13),e.BQk(),e.ynx(4,14),e.YNc(5,le,2,0,"th",12)(6,ie,2,1,"td",13),e.BQk(),e.ynx(7,15),e.YNc(8,ce,2,0,"th",12)(9,ue,3,4,"td",13),e.BQk(),e.ynx(10,16),e.YNc(11,pe,2,0,"th",12)(12,me,2,0,"td",17),e.BQk(),e.YNc(13,de,1,0,"tr",18)(14,ge,1,0,"tr",19),e.qZA()}if(2&t){const s=e.oxw(2);e.Q6J("dataSource",s.resultList)("trackBy",s.tracker),e.xp6(13),e.Q6J("matHeaderRowDef",s.displayColumns),e.xp6(1),e.Q6J("matRowDefColumns",s.displayColumns)}}function he(t,a){if(1&t){const s=e.EpF();e.TgZ(0,"mat-card")(1,"mat-card-content"),e.YNc(2,fe,15,4,"table",8),e.TgZ(3,"div")(4,"mfmp-custom-paginator",9),e.NdJ("pager",function(o){e.CHM(s);const c=e.oxw();return e.KtG(c.handlePageEvent(o))}),e.qZA()()()()}if(2&t){const s=e.oxw();e.xp6(2),e.Q6J("ngIf",s.resultList),e.xp6(2),e.Q6J("rows",s.rows?s.rows:void 0)}}let _e=(()=>{class t{constructor(){this.featureService=(0,e.f3M)(f),this.sorter=new e.vpe,this.opener=new e.vpe,this.displayColumns=["query","size","date","link"],this.sortedData=[],this.buildDataSource=()=>{this.dataSource=new p.by(this.resultList||[])},this.openLink=s=>{this.opener.emit(s)}}set ready(s){this.flowSwitch=s?2:0+(this.error?1:0)}set error(s){this.flowSwitch=this.ready?2:0+(s?1:0)}sortTable(s){this.sorter.emit(s)}ngOnInit(){this.buildDataSource()}ngAfterViewInit(){this.resultList&&(this.dataSource.data=this.resultList,this.dataSource.sort=this.sort)}tracker(s,n){return n.link}handlePageEvent(s){console.log("from custompaginator.nextPage");const n=s;n.page=s.page,n.size=s.size,n.sizes=s.sizes,this.pageSize=n.size,this.pageIndex=n.page,this.pageSizes=n.sizes,this.featureService.navigate(n)}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-all-results-face"]],viewQuery:function(n,o){if(1&n&&e.Gf(A.YE,5),2&n){let c;e.iGM(c=e.CRH())&&(o.sort=c.first)}},inputs:{pageSize:"pageSize",pageSizes:"pageSizes",rows:"rows",ready:"ready",error:"error",resultList:"resultList"},outputs:{sorter:"sorter",opener:"opener"},standalone:!0,features:[e.jDz],decls:12,vars:3,consts:[[3,"ngSwitch"],[4,"ngSwitchCase"],[4,"ngSwitchDefault"],[1,"wrapper"],["errorTemplate",""],["waitingTemplate",""],["readyTemplate",""],[4,"ngTemplateOutlet"],["mat-table","","matSort","","displayedColumns","displayColumns",3,"dataSource","trackBy","matSortChange",4,"ngIf"],[3,"rows","pager"],["mat-table","","matSort","","displayedColumns","displayColumns",3,"dataSource","trackBy","matSortChange"],["matColumnDef","query"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","size"],["matColumnDef","date"],["matColumnDef","link"],["class","hover","mat-cell","",3,"click",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],["mat-cell","",1,"hover",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(n,o){1&n&&(e.ynx(0,0),e.YNc(1,q,2,1,"ng-container",1)(2,ee,2,1,"ng-container",1)(3,se,2,1,"ng-container",2),e.BQk(),e.TgZ(4,"mat-card",3)(5,"mat-card-content"),e.YNc(6,ne,7,3,"ng-template",null,4,e.W1O)(8,ae,3,0,"ng-template",null,5,e.W1O)(10,he,5,2,"ng-template",null,6,e.W1O),e.qZA()()),2&n&&(e.Q6J("ngSwitch",o.flowSwitch),e.xp6(1),e.Q6J("ngSwitchCase",1),e.xp6(1),e.Q6J("ngSwitchCase",0))},dependencies:[d.ez,d.O5,d.tP,d.RF,d.n9,d.ED,d.Ts,d.uU,C.QW,C.a8,C.dn,A.JX,A.YE,A.nU,p.p0,p.BZ,p.fO,p.as,p.w1,p.Dz,p.nj,p.ge,p.ev,p.XQ,p.Gk,L.y,$.O],styles:[".wrapper[_ngcontent-%COMP%]{height:100%}.hover[_ngcontent-%COMP%]:hover{cursor:pointer;text-decoration:underline}"]})}return t})();var ye=r(5619),Re=r(1476);class ve{}const Ae=[{path:"",component:(()=>{class t{constructor(){this.store=(0,e.f3M)(l.yh),this.headerService=(0,e.f3M)(y.d),this.featureService=(0,e.f3M)(f),this.results=(0,R.of)([]),this.pageIndex=0,this.pageSize=new ye.X(10),this.pageSizes=[5,10,15,25],this.pageEvent=new Re.kl,this.pageManager=new ve,this.openLink=s=>{this.featureService.openLink(s)},this.sortData=s=>{this.store.dispatch(i.sort({payload:s}))}}ngOnInit(){this.page=(0,R.of)([]),this.pageManager.page=1,this.pageManager.size=10,this.pageManager.sizes=this.pageSizes,this.headerService.buildPageHeader("all-results"),this.results=this.store.select(m.selectResults),this.page=this.store.select(m.selectPage),this.rows=this.store.select(m.selectRows),this.ready=this.store.select(m.selectReady),this.error=this.store.select(m.selectError),this.store.dispatch(i.loadResults({query:"TODO: remove this"}))}switchPage(s){const n=s;console.log(`head: navigator: ${n}`),this.pageSize.next(n.size),this.store.dispatch(i.setPage({payload:n}))}static#e=this.\u0275fac=function(n){return new(n||t)};static#t=this.\u0275cmp=e.Xpm({type:t,selectors:[["mfmp-all-results-head"]],standalone:!0,features:[e.jDz],decls:6,vars:16,consts:[[3,"resultList","pageSize","pageSizes","ready","error","rows","opener","sorter"]],template:function(n,o){1&n&&(e.TgZ(0,"mfmp-all-results-face",0),e.NdJ("opener",function(g){return o.openLink(g)})("sorter",function(g){return o.sortData(g)}),e.ALo(1,"async"),e.ALo(2,"async"),e.ALo(3,"async"),e.ALo(4,"async"),e.ALo(5,"async"),e.qZA()),2&n&&e.Q6J("resultList",e.lcZ(1,6,o.page))("pageSize",e.lcZ(2,8,o.pageSize))("pageSizes",o.pageSizes)("ready",e.lcZ(3,10,o.ready))("error",e.lcZ(4,12,o.error))("rows",e.lcZ(5,14,o.rows))},dependencies:[d.ez,d.Ov,_e],encapsulation:2})}return t})(),providers:[(0,l.oY)(m),(0,u.y3)([v]),{provide:f,useClass:f},{provide:y.d,useClass:y.d}]},{path:"reports",component:E.a,providers:[(0,l.oY)(m),(0,u.y3)([v]),{provide:f,useClass:f},{provide:y.d,useClass:y.d}]},{path:"paginator",component:L.y}]}}]);